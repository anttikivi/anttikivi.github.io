---
import HeaderLink from "@/components/HeaderLink.astro";
import localeNav from "@/data/header-locale-nav";
import locales, { type Locale } from "@/data/locales";
import type { RouteKey } from "@/data/routes";
import { useTranslations } from "@/utils/i18n";
import { getRouteKey, isErrorPage, isTranslated, routeLocale } from "@/utils/routes";

interface Props {
    class?: string;
}

const { class: className } = Astro.props;

const locale = routeLocale(Astro.routePattern, Astro.currentLocale);
const t = useTranslations("layout", locale);

const translations = [] as {
    href: RouteKey;
    label: string;
    locale: Locale;
}[];

if (!isErrorPage(Astro.routePattern)) {
    for (const l of locales) {
        if (l === locale) {
            continue;
        }

        if (!(await isTranslated(Astro.url, l))) {
            continue;
        }

        translations.push({
            href: getRouteKey(Astro.url) as Exclude<RouteKey, "404">,
            label: localeNav[l],
            locale: l,
        });
    }
}
---

{
    translations.length > 0 && (
        <ul class={className} aria-label={t("languageMenu")}>
            {translations.map((t) => (
                <li lang={t.locale}>
                    <HeaderLink href={t.href} locale={t.locale}>
                        {t.label}
                    </HeaderLink>
                </li>
            ))}
        </ul>
    )
}
